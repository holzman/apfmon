{% extends "mon/base.html" %}
{% load url from future %}


{% block title %}UK pilot factory monitor{% endblock %}

{% block content %}

<div class=row-fluid>
<table class="table table-compact">
<tr>
  <td>FACTORY
  <td><a href="{% url 'atl.mon.views.factory' job.fid.id %}">{{ job.fid }}</a>
<tr>
  <td>JOB_ID
  <td> {{ job.cid }} (<a href="{{ outurl }}">stdout</a>, <a href="{{ errurl }}">stderr</a>, <a href="{{ logurl }}">stdlog</a>, only recent logs)
<tr>
  <td>PANDAQ
  <td><a href="{% url 'atl.mon.views.pandaq' job.pandaq.id %}">{{ job.pandaq }}</a>
<tr>
  <td>CREATED
  <td>{{ job.created|date:"Y-m-d H:m:s" }} ({{ job.created|timesince }} ago)
<tr>
  <td>LAST MODIFIED
  <td> {{ job.last_modified|date:"Y-m-d H:m:s" }} ({{ job.last_modified|timesince }} ago)
<tr>
  <td>STATE
  <td>{{ job.state }}
<tr>
  <td>PAYLOAD?
  {% if job.result == 20 %}
    <td>miss
  {% elif job.result == -1 %}
    <td>-
  {% elif job.result == 0 %}
    <td>yes
  {% else %}
    <td>\o/
  {% endif %}

<tr>
  <td>PILOTCODE
  {% ifequal job.result -1 %}
    <td>-
  {% else %}
    <td>{{ job.result }}
  {% endifequal %}
<tr>
  <td>FLAG
  <td>{{ job.flag }}
{% for pid in pids %}
<tr><td>PANDAID<td> <a href="http://panda.cern.ch:25980/server/pandamon/query?job={{ pid }}">{{ pid }}</a>
{% endfor %}

</table>
</div>

<div class=row-fluid>
<div class=span6>
<table class="table table-compact table-striped">
<tr class=odd>
<td>{{ job.created|date:"Y-m-d H:m:s" }}
<td>{{ job.fid.ip }}
<td>CREATED
</tr>
{% for m in msgs %}
<tr class="{% cycle even,odd %}">
<td>{{ m.received|date:"Y-m-d H:i:s" }}
<td>{{ m.client }}
<td>{{ m.msg }}
</tr>
{% endfor %}
{% comment %}
{% ifequal job.state.name 'FAULT' %}
<tr class=note>
<td class=note colspan=3>"FAULT, stale job" means the wrapper hit a timeout.
{% endifequal %}
{% endcomment %}
</table>
</div>
</div>

{% endblock %}
