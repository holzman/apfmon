{% extends "mon/base.html" %}
{% load timesince_human %}

{% block content %}

<h2>Cloud view - {{ cloud }}</h2>

<p>
<ul style=list-style-type:none>
<li>Active factories serving this cloud:
{% for f in factive %}
  <li><a href="{% url atl.mon.views.factory f.id %}">{{ f }}</a>
{% endfor %}
</ul>

{% if finactive %}
<ul style=list-style-type:none>
<li>Inactive factories serving this cloud:
{% for f in finactive %}
  <li><a href="{% url atl.mon.views.factory f.id %}">{{ f }}</a>
{% endfor %}
</ul>
{% endif %}
</p>

<table class=text>
<tr>
<th class=colhdr title="Site name">Site
<th title="Panda queue, links to schedconfig">panda queue
<th title="Panda queue status">state
<th class=numeric title="nJobs running, all factories">running
<th title="Schedconfig comment">comment</tr>
{% for site in sites %}
  <tr>
    <td class=colhdr><a href="{% url atl.mon.views.site site.id %}">{{ site }}</a>
  </tr>

  {% for row in rows %}
  {% ifequal row.site.name site.name %}
  <tr class="{% cycle odd,even %}">
    <td style=background:white>
    <td class="{{ row.pandaq.type }}" title="{{ row.pandaq.type }}">
      <a href="http://panda.cern.ch/server/pandamon/query?tp=queue&id={{ row.pandaq.name }}">{{ row.pandaq }}</a>
    <td class="{{ row.pandaq.state }} {{ row.pandaq.type }}">{{ row.pandaq.state }}
    <td class="numeric -text">{{ row.running }}
    {% if row.url %}
      <td class="note {{ row.pandaq.type }}"
          title="{{ row.pandaq.last_modified|timesince_human }}">
         {{ row.prefix }}<a href="{{ row.url }}">{{ row.suffix }}</a>
    {% else %}
      {% ifequal row.pandaq.comment 'empty.comment' %}
        <td class="note {{ row.pandaq.type }}" 
      {% else %}
        <td class="note {{ row.pandaq.type }}" 
          title="{{ row.pandaq.last_modified|timesince_human }}">
          {{ row.pandaq.comment }}
      {% endifequal %}
    {% endif %}
  </tr>
  {% endifequal %}
  {% comment %}
  {% endcomment %}
  
  {% endfor %}
{% endfor %}

</table>

{% endblock %}
{% comment %}
{% endcomment %}
